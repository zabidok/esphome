# file packages_pysoon/buttons.yaml
button:
  - platform: template
    id: btn_start_watering
    name: "Start Watering"
    icon: "mdi:play-circle"
    on_press:
      then:
        - script.execute: start_watering

  - platform: template
    id: btn_stop_watering
    name: "Stop Watering"
    icon: "mdi:stop-circle"
    on_press:
      then:
        - script.execute: stop_watering

  - platform: template
    name: "Dose Test"
    icon: "mdi:water-plus-outline"
    entity_category: config
    on_press:
      then:
        - script.execute: dose_ml

  - platform: template
    name: "Route → Big Plant"
    icon: "mdi:pipe-valve"
    on_press:
      then:
        - switch.turn_on: outlet_selector

  - platform: template
    name: "Route → Small Plant"
    icon: "mdi:pipe-valve"
    on_press:
      then:
        - switch.turn_off: outlet_selector

  - platform: template
    name: "Dose Both"
    icon: "mdi:water-sync"
    on_press:
      then:
        - script.execute: dose_both
        
  - platform: template
    name: "Reset Lifetime Totals"
    icon: "mdi:restart"
    on_press:
      - logger.log: "Resetting lifetime counters"
      # Reset persistent pulse counters (stored in flash)
      - globals.set:
          id: lifetime_pulses_big
          value: "0"
      - globals.set:
          id: lifetime_pulses_small
          value: "0"

      # Optional: realign session baseline so next session starts clean
      - lambda: |-
          // Align session baseline to current total (optional)
          id(start_pulses) = (uint32_t) id(total_pulses).state;

      # Push 0 to the derived sensors so UI updates immediately
      - sensor.template.publish:
          id: ml_total_big
          state: 0.0
      - sensor.template.publish:
          id: ml_total_small
          state: 0.0
      - sensor.template.publish:
          id: ml_total_lifetime
          state: 0.0
